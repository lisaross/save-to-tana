class n{apiKeyInput;targetNodeIdInput;supertagIdInput;saveButton;tanaSchemaInput;extractSchemaButton;extractedFieldsDiv;extractedFieldIdsPre;fieldIdUrlInput;fieldIdAuthorInput;fieldIdDescriptionInput;fieldIdContentInput;schemaErrorDiv;toast=null;constructor(){this.apiKeyInput=document.getElementById("apiKey"),this.targetNodeIdInput=document.getElementById("targetNodeId"),this.supertagIdInput=document.getElementById("supertagId"),this.saveButton=document.getElementById("saveButton"),this.tanaSchemaInput=document.getElementById("tanaSchema"),this.extractSchemaButton=document.getElementById("extractSchemaButton"),this.extractedFieldsDiv=document.getElementById("extractedFields"),this.extractedFieldIdsPre=document.getElementById("extractedFieldIds"),this.fieldIdUrlInput=document.getElementById("fieldIdUrl"),this.fieldIdAuthorInput=document.getElementById("fieldIdAuthor"),this.fieldIdDescriptionInput=document.getElementById("fieldIdDescription"),this.fieldIdContentInput=document.getElementById("fieldIdContent"),this.toast=document.getElementById("toast"),this.schemaErrorDiv=document.createElement("div"),this.schemaErrorDiv.className="status error",this.schemaErrorDiv.style.display="none",this.tanaSchemaInput.parentNode?.insertBefore(this.schemaErrorDiv,this.tanaSchemaInput.nextSibling),this.initializePage()}initializePage(){this.loadConfiguration(),this.saveButton.addEventListener("click",this.saveConfiguration.bind(this)),this.extractSchemaButton.addEventListener("click",this.extractSchemaFromTextarea.bind(this)),this.apiKeyInput.addEventListener("input",this.validateForm.bind(this)),this.targetNodeIdInput.addEventListener("input",this.validateForm.bind(this)),this.supertagIdInput.addEventListener("input",this.validateForm.bind(this)),this.fieldIdUrlInput.addEventListener("input",this.validateForm.bind(this)),this.fieldIdAuthorInput.addEventListener("input",this.validateForm.bind(this)),this.fieldIdDescriptionInput.addEventListener("input",this.validateForm.bind(this)),this.fieldIdContentInput.addEventListener("input",this.validateForm.bind(this)),this.initializeExampleJsonToggle()}initializeExampleJsonToggle(){const a=document.getElementById("toggleExampleJson"),i=document.getElementById("exampleJsonBlock"),t=document.getElementById("toggleExampleJsonLabel");a&&i&&t&&a.addEventListener("click",()=>{const e=a.getAttribute("aria-expanded")==="true";a.setAttribute("aria-expanded",String(!e)),i.style.display=e?"none":"block",t.textContent=e?"Show Example JSON":"Hide Example JSON"})}loadConfiguration(){chrome.storage.local.get(["apiKey"],a=>{chrome.storage.sync.get(["apiKey","supertagId","targetNodeId","tanaFieldIds"],i=>{const t={...i,apiKey:a.apiKey||i.apiKey};i.apiKey&&!a.apiKey&&chrome.storage.local.set({apiKey:i.apiKey},()=>{chrome.storage.sync.remove(["apiKey"]),console.log("Migrated API key to local storage")});const e={...t,apiKey:t.apiKey?"***":void 0};console.log("Loaded configuration:",e),t.apiKey&&(this.apiKeyInput.value=t.apiKey),t.targetNodeId&&(this.targetNodeIdInput.value=t.targetNodeId),t.supertagId&&(this.supertagIdInput.value=t.supertagId),t.tanaFieldIds&&(this.fieldIdUrlInput.value=t.tanaFieldIds.URL||"",this.fieldIdAuthorInput.value=t.tanaFieldIds.Author||"",this.fieldIdDescriptionInput.value=t.tanaFieldIds.Description||"",this.fieldIdContentInput.value=t.tanaFieldIds.Content||""),this.validateForm()})})}saveConfiguration(){const a=this.apiKeyInput.value.trim(),i=this.targetNodeIdInput.value.trim(),t=this.supertagIdInput.value.trim(),e={URL:this.fieldIdUrlInput.value.trim(),Author:this.fieldIdAuthorInput.value.trim(),Description:this.fieldIdDescriptionInput.value.trim(),Content:this.fieldIdContentInput.value.trim()};if(!a){this.showToast("API Token is required",!0);return}if(!i){this.showToast("Target Node ID is required",!0);return}if(!t){this.showToast("Save to Tana Supertag ID is required. Please extract schema.",!0);return}if(!e.URL||!e.Author||!e.Description||!e.Content){this.showToast("All field IDs are required.",!0);return}chrome.storage.local.set({apiKey:a},()=>{chrome.storage.sync.set({targetNodeId:i,supertagId:t,tanaFieldIds:e},()=>{this.showToast("Configuration saved successfully!")})})}validateForm(){const a=this.apiKeyInput.value.trim(),i=this.targetNodeIdInput.value.trim(),t=this.supertagIdInput.value.trim();this.saveButton.disabled=!a||!i||!t}showToast(a,i=!1){this.toast&&(this.toast.textContent=a,this.toast.className="toast"+(i?" error":" success")+" show",setTimeout(()=>{this.toast&&(this.toast.className="toast"+(i?" error":" success"),this.toast.textContent="")},5e3))}extractSchemaFromTextarea(){this.schemaErrorDiv.style.display="none",this.schemaErrorDiv.textContent="";const a=this.tanaSchemaInput.value;let i;try{i=JSON.parse(a)}catch(t){const e=t;this.schemaErrorDiv.textContent="Could not parse JSON. Please paste the API payload as copied from Tana. Error: "+e.message,this.schemaErrorDiv.style.display="block",this.extractedFieldsDiv.style.display="none";return}try{const t=this.extractSchemaInfo(i);this.supertagIdInput.value=t.supertagId,this.fieldIdUrlInput.value=t.fieldIds.URL||"",this.fieldIdAuthorInput.value=t.fieldIds.Author||"",this.fieldIdDescriptionInput.value=t.fieldIds.Description||"",this.fieldIdContentInput.value=t.fieldIds.Content||"",this.extractedFieldsDiv.style.display="block",this.extractedFieldIdsPre.textContent="Supertag ID: "+t.supertagId+`
`+Object.entries(t.fieldIds).map(([e,s])=>`${e} ID: ${s}`).join(`
`),chrome.storage.sync.get(["targetNodeId"],e=>{chrome.storage.sync.set({targetNodeId:e.targetNodeId||"",supertagId:t.supertagId,tanaFieldIds:t.fieldIds},()=>{this.showToast("Schema extracted and saved!")})})}catch(t){const e=t;this.schemaErrorDiv.textContent="Failed to extract schema info: "+e.message,this.schemaErrorDiv.style.display="block",this.extractedFieldsDiv.style.display="none"}}extractSchemaInfo(a){const i=Array.isArray(a.nodes)?a.nodes[0]:null;if(!i)throw new Error("No nodes found in schema payload.");const t=i.supertags?.[0]?.id||"";if(!t)throw new Error("No supertag ID found in schema.");const e={};if(Array.isArray(i.children))for(const s of i.children)s.type==="field"&&s.attributeId&&(s.children?.[0]?.dataType==="url"?e.URL=s.attributeId:e.Author===void 0?e.Author=s.attributeId:e.Description===void 0?e.Description=s.attributeId:e.Content=s.attributeId);return{supertagId:t,fieldIds:e}}static cleanSchemaString(a){const i=a.split(`
`);i[0].trim().startsWith("type")&&i.shift(),i[i.length-1].trim().replace(/[;\s]/g,"")==="}"&&i.pop();let t=i.map(e=>e.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*$/g,"").replace(/^\s*\w+\??:.*;\s*$/g,"").replace(/;/g,"").replace(/\?/g,"").replace(/'/g,'"').trim()).filter(e=>e.length>0).join(`
`);return t=t.replace(/,\s*([\]\}])/g,"$1"),t=t.replace(/(^|[,{\s])(\w+):/g,'$1"$2":'),t.trim().startsWith("{")||(t="{"+t+"}"),t}}document.addEventListener("DOMContentLoaded",()=>{new n});
//# sourceMappingURL=options.js.map
