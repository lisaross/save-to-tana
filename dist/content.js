import{s as k}from"./textUtils-DJNAmfRs.js";function q(s){const o=s.defaultView?.Node,A=s.defaultView?.Element;function C(e){if(o&&e instanceof o&&e.nodeType===o.TEXT_NODE)return e.textContent||"";if(!(A&&e instanceof A))return"";switch(e.tagName){case"A":{const t=e.href;return`[${Array.from(e.childNodes).map(C).join("")}](${t})`}case"STRONG":case"B":return`**${Array.from(e.childNodes).map(C).join("")}**`;case"EM":case"I":return`*${Array.from(e.childNodes).map(C).join("")}*`;default:return Array.from(e.childNodes).map(C).join("")}}function E(e,t=800){const n=k(e);if(n.length<=t)return n;if(n.includes("](")||n.includes("http")){const c=n.match(/\[([^\]]+)\]\(([^)]+)\)/);if(c&&c[0].length<t){const i=n.indexOf(c[0]),m=n.substring(0,i),y=n.substring(i+c[0].length),p=t-c[0].length,T=m.length>p/2?m.substring(0,Math.floor(p/2))+"...":m,w=y.length>p/2?"..."+y.substring(y.length-Math.floor(p/2)):y;return(T+c[0]+w).trim()}}const r=n.match(/[^.!?]+[.!?]+/g);if(r&&r.length>1){let c="";for(const i of r)if((c+i).length<=t)c+=i;else break;if(c.length>t*.5)return c.trim()}const u=n.substring(0,t),a=u.lastIndexOf(" ");return a>t*.7?u.substring(0,a)+"...":u+"..."}function M(e,t=2e3){if(e.length<=t)return[e];const n=[],l=e.match(/[^.!?]+[.!?]+/g)||[e];let r="";for(const u of l){const a=u.trim();if(a)if((r+" "+a).length>t)if(r&&(n.push(r.trim()),r=""),a.length>t){const c=Array.from(a.matchAll(/\[([^\]]+)\]\(([^)]+)\)/g));if(c.length>0){let i=a;for(;i.length>t;){let m=t;for(const p of c){const T=i.indexOf(p[0]),w=T+p[0].length;if(T<t&&w>t){m=Math.max(T-1,t/2);break}}const y=i.substring(0,m);n.push(y+(m<i.length?"...":"")),i=i.substring(m)}i.trim()&&n.push(i.trim())}else for(let i=0;i<a.length;i+=t){const m=a.slice(i,i+t);n.push(m+(i+t<a.length?"...":""))}}else r=a;else r+=(r?" ":"")+a}return r.trim()&&n.push(r.trim()),n.length>0?n:[e.substring(0,t)+"..."]}function O(e){const t=e.tagName.toLowerCase(),n=e.className||"",l=e.id||"",r=e.getAttribute("role")||"";if(["script","style","noscript","head","meta","link"].includes(t)||t==="nav"||r==="navigation")return!0;const u=["nav","navigation","menu","header","footer","sidebar","aside","breadcrumb","toolbar","topbar","bottombar","social","share","cookie","banner","popup","modal","overlay","fixed","sticky","advertisement","ads","promo"],a=(n+" "+l).toLowerCase();if(u.some(i=>a.includes(i)))return!0;const c=e.getAttribute("style")||"";return!!(c.includes("position: fixed")||c.includes("position: absolute")||c.includes("display: none")||c.includes("visibility: hidden"))}function x(e){const t=e.tagName.toLowerCase(),n=e.className||"",l=e.id||"";if(["section","article","main","div","p","ul","ol","blockquote","h1","h2","h3","h4","h5","h6"].includes(t)){if(["p","ul","ol","blockquote","h1","h2","h3","h4","h5","h6"].includes(t))return!0;const r=["content","text","body","article","section","block","panel","card","item","feature","intro","description","summary"],u=(n+" "+l).toLowerCase(),a=r.some(i=>u.includes(i)),c=t==="div"&&(e.parentElement?.tagName.toLowerCase()==="body"||e.parentElement?.tagName.toLowerCase()==="main"||e.parentElement?.className.includes("container")||e.parentElement?.className.includes("wrapper")||e.parentElement?.className.includes("content"));return a||c||["section","article","main"].includes(t)}return!1}function _(e){const t=e.cloneNode(!0),n=t.querySelectorAll("nav, .nav, .navigation, .menu, .breadcrumb, .social, .share, script, style");for(const r of Array.from(n))r.remove();let l="";for(const r of Array.from(t.childNodes))r.nodeType===(o?.TEXT_NODE||3)?l+=r.textContent||"":r.nodeType===(o?.ELEMENT_NODE||1)&&(l+=C(r));return k(l)}let g=null;try{g=s.querySelector("main")||s.querySelector('[role="main"]')||s.querySelector(".main-content")||s.querySelector("#main-content")||s.querySelector(".content")||s.body}catch{g=s.body}if(!g)return[];const d=[],S=new Set;function v(e){for(const t of Array.from(e.children))if(!(S.has(t)||O(t))){if(x(t)){const n=_(t);if(n.length>10&&n.length<8e3){if(d.push({element:t,content:n}),S.add(t),d.length>=50)return;continue}}!S.has(t)&&d.length<50&&v(t)}}if(v(g),d.length<3){const e=g.querySelectorAll("div, section, article, p, ul, ol, blockquote");for(const t of Array.from(e)){if(S.has(t)||O(t))continue;const n=_(t);if(n.length>15&&n.length<5e3&&(d.push({element:t,content:n}),S.add(t),d.length>=50))break}}const N=[];for(const e of d.slice(0,50)){const t=e.content.split(/[.!?]/)[0],n=E(t,200),l=M(e.content);if(l.length===1)N.push({name:E(l[0])});else{const r=l.map(u=>({name:k(u)}));N.push({name:n,children:r})}}if(N.length===0){const e=_(g);if(e.length>15){const t=M(e);if(t.length===1)N.push({name:E(t[0])});else{const n=E(s.title||"Page Content");N.push({name:n,children:t.map(l=>({name:k(l)}))})}}}return[{name:E(s.title||"Page Content"),supertags:[],children:N}]}chrome.runtime.onMessage.addListener((s,b,f)=>{if(s.action==="ping")return f({pong:!0}),!0;if(s.action==="extractContent"){const h=s.options||{includeContent:!0,includeTitle:!0};try{const o={url:window.location.href,title:document.title,author:X(),description:D(),content:""};if(h.includeContent)try{o.hierarchicalNodes=q(document)}catch(A){console.warn("Could not extract hierarchical content:",A)}(!h.includeTitle||!o.title)&&(o.title=o.url),o.title&&(o.title=o.title.replace(/\r?\n|\r/g," ").trim()),f(o)}catch(o){console.error("Content extraction error:",o),f({url:window.location.href,title:document.title,author:"",description:"",content:"",error:!0,message:o instanceof Error?o.message:"Unknown error occurred during content extraction"})}}return!0});function X(){const s=['meta[name="author"]','meta[property="article:author"]','meta[name="twitter:creator"]','meta[property="og:site_name"]'];for(const h of s){const o=document.querySelector(h);if(o&&o.getAttribute("content"))return o.getAttribute("content")||""}const b=['[itemtype*="schema.org/Person"] [itemprop="name"]','[itemtype*="schema.org/Organization"] [itemprop="name"]'];for(const h of b){const o=document.querySelector(h);if(o&&o.textContent)return o.textContent.trim()}const f=[".byline",".author",".article-author"];for(const h of f){const o=document.querySelector(h);if(o&&o.textContent)return o.textContent.trim()}return""}function D(){const s=['meta[name="description"]','meta[property="og:description"]','meta[name="twitter:description"]'];for(const b of s){const f=document.querySelector(b);if(f&&f.getAttribute("content"))return f.getAttribute("content")||""}return""}
//# sourceMappingURL=content.js.map
